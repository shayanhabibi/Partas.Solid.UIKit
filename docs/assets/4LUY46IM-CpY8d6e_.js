import{c as p,a as d,b as N,s as v,n as g,r as c,g as E,d as y,e as P,f,u as S}from"./index-3YZot88q.js";import{b as A,f as l,h as M}from"./iframe-mHl6JQ-c.js";var[k,D]=d({hookName:"useRenderStrategyContext",providerName:"<RenderStrategyProvider />"}),O=e=>p()(e,["lazyMount","unmountOnExit"]);function U(e,t){const{state:s,send:n,context:o}=e,i=s.matches("mounted","unmountSuspended");return{skip:!o.get("initial"),present:i,setNode(a){a&&n({type:"NODE.SET",node:a})},unmount(){n({type:"UNMOUNT"})}}}var x=N({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,prop:t,send:s}){e([()=>t("present")],()=>{s({type:"PRESENCE.CHANGED"})})},on:{"NODE.SET":{actions:["setupNode"]},"PRESENCE.CHANGED":{actions:["setInitial","syncPresence"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},invokeOnExitComplete:({prop:e})=>{e("onExitComplete")?.()},setupNode:({refs:e,event:t})=>{e.get("node")!==t.node&&(e.set("node",t.node),e.set("styles",E(t.node)))},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},syncPresence:({context:e,refs:t,send:s,prop:n})=>{const o=n("present");if(o)return s({type:"MOUNT",src:"presence.changed"});const i=t.get("node");if(!o&&i?.ownerDocument.visibilityState==="hidden")return s({type:"UNMOUNT",src:"visibilitychange"});c(()=>{const a=m(t.get("styles"));e.set("unmountAnimationName",a),a==="none"||a===e.get("prevAnimationName")||t.get("styles")?.display==="none"||t.get("styles")?.animationDuration==="0s"?s({type:"UNMOUNT",src:"presence.changed"}):s({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{c(()=>{e.set("prevAnimationName",m(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:s})=>{const n=t.get("node");if(!n)return;const o=r=>{(r.composedPath?.()?.[0]??r.target)===n&&e.set("prevAnimationName",m(t.get("styles")))},i=r=>{const u=m(t.get("styles"));y(r)===n&&u===e.get("unmountAnimationName")&&s({type:"UNMOUNT",src:"animationend"})};n.addEventListener("animationstart",o),n.addEventListener("animationcancel",i),n.addEventListener("animationend",i);const a=v(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",o),n.removeEventListener("animationcancel",i),n.removeEventListener("animationend",i),g(()=>a())}}}}});function m(e){return e?.animationName||"none"}P()(["onExitComplete","present","immediate"]);var R=e=>p()(e,["immediate","lazyMount","onExitComplete","present","skipAnimationOnMount","unmountOnExit"]),L=e=>{const[t,s]=O(f(e)),[n,o]=A(!1),i=S(x,e),a=l(()=>U(i));return M(()=>{a().present&&o(!0)}),l(()=>({unmounted:!a().present&&!n()&&t.lazyMount||t.unmountOnExit&&!a().present&&n(),present:a().present,ref:a().setNode,presenceProps:{hidden:!a().present,"data-state":a().skip&&s.skipAnimationOnMount?void 0:s.present?"open":"closed"}}))},[I,w]=d({hookName:"usePresenceContext",providerName:"<PresenceProvider />"});export{I as P,k as R,L as a,O as b,w as c,R as s,D as u};
