import{g as y,C as K,h,D as N,d as v,E as A}from"./index-DaBFbvzD.js";import{h as O,q as m,s as S,o as R,k as U,c as T,m as H,n as V,u as $}from"./iframe-mHl6JQ-c.js";import{a as x}from"./index-D4JJ8pSH.js";import{P as q}from"./FLVHQV4A-DzmScvHC.js";import{m as W}from"./index-ncGqb3xy.js";var Y="data-kb-top-layer",C,w=!1,u=[];function f(t){return u.findIndex(n=>n.node===t)}function j(t){return u[f(t)]}function z(t){return u[u.length-1].node===t}function I(){return u.filter(t=>t.isPointerBlocking)}function G(){return[...I()].slice(-1)[0]}function b(){return I().length>0}function F(t){const n=f(G()?.node);return f(t)<n}function J(t){u.push(t)}function Q(t){const n=f(t);n<0||u.splice(n,1)}function X(){for(const{node:t}of u)t.style.pointerEvents=F(t)?"none":"auto"}function Z(t){if(b()&&!w){const n=y(t);C=document.body.style.pointerEvents,n.body.style.pointerEvents="none",w=!0}}function ee(t){if(b())return;const n=y(t);n.body.style.pointerEvents=C,n.body.style.length===0&&n.body.removeAttribute("style"),w=!1}var r={layers:u,isTopMostLayer:z,hasPointerBlockingLayer:b,isBelowPointerBlockingLayer:F,addLayer:J,removeLayer:Q,indexOf:f,find:j,assignPointerEventToLayers:X,disableBodyPointerEvents:Z,restoreBodyPointerEvents:ee},k="interactOutside.pointerDownOutside",B="interactOutside.focusOutside";function ne(t,n){let i,s=K;const c=()=>y(n()),d=e=>t.onPointerDownOutside?.(e),D=e=>t.onFocusOutside?.(e),P=e=>t.onInteractOutside?.(e),g=e=>{const o=e.target;return!(o instanceof Element)||o.closest(`[${Y}]`)||!v(c(),o)||v(n(),o)?!1:!t.shouldExcludeElement?.(o)},L=e=>{function o(){const a=n(),l=e.target;if(!a||!l||!g(e))return;const p=h([d,P]);l.addEventListener(k,p,{once:!0});const _=new CustomEvent(k,{bubbles:!1,cancelable:!0,detail:{originalEvent:e,isContextMenu:e.button===2||N(e)&&e.button===0}});l.dispatchEvent(_)}e.pointerType==="touch"?(c().removeEventListener("click",o),s=o,c().addEventListener("click",o,{once:!0})):o()},E=e=>{const o=n(),a=e.target;if(!o||!a||!g(e))return;const l=h([D,P]);a.addEventListener(B,l,{once:!0});const p=new CustomEvent(B,{bubbles:!1,cancelable:!0,detail:{originalEvent:e,isContextMenu:!1}});a.dispatchEvent(p)};O(()=>{x(t.isDisabled)||(i=window.setTimeout(()=>{c().addEventListener("pointerdown",L,!0)},0),c().addEventListener("focusin",E,!0),m(()=>{window.clearTimeout(i),c().removeEventListener("click",s),c().removeEventListener("pointerdown",L,!0),c().removeEventListener("focusin",E,!0)}))})}function te(t){const n=i=>{i.key===A.Escape&&t.onEscapeKeyDown?.(i)};O(()=>{if(x(t.isDisabled))return;const i=t.ownerDocument?.()??y();i.addEventListener("keydown",n),m(()=>{i.removeEventListener("keydown",n)})})}var M=V();function oe(){return $(M)}function ue(t){let n;const i=oe(),[s,c]=S(t,["ref","disableOutsidePointerEvents","excludedElements","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss","bypassTopMostLayerCheck"]),d=new Set([]),D=e=>{d.add(e);const o=i?.registerNestedLayer(e);return()=>{d.delete(e),o?.()}};ne({shouldExcludeElement:e=>n?s.excludedElements?.some(o=>v(o(),e))||[...d].some(o=>v(o,e)):!1,onPointerDownOutside:e=>{!n||r.isBelowPointerBlockingLayer(n)||!s.bypassTopMostLayerCheck&&!r.isTopMostLayer(n)||(s.onPointerDownOutside?.(e),s.onInteractOutside?.(e),e.defaultPrevented||s.onDismiss?.())},onFocusOutside:e=>{s.onFocusOutside?.(e),s.onInteractOutside?.(e),e.defaultPrevented||s.onDismiss?.()}},()=>n),te({ownerDocument:()=>y(n),onEscapeKeyDown:e=>{!n||!r.isTopMostLayer(n)||(s.onEscapeKeyDown?.(e),!e.defaultPrevented&&s.onDismiss&&(e.preventDefault(),s.onDismiss()))}}),R(()=>{if(!n)return;r.addLayer({node:n,isPointerBlocking:s.disableOutsidePointerEvents,dismiss:s.onDismiss});const e=i?.registerNestedLayer(n);r.assignPointerEventToLayers(),r.disableBodyPointerEvents(n),m(()=>{n&&(r.removeLayer(n),e?.(),r.assignPointerEventToLayers(),r.restoreBodyPointerEvents(n))})}),O(U([()=>n,()=>s.disableOutsidePointerEvents],([e,o])=>{if(!e)return;const a=r.find(e);a&&a.isPointerBlocking!==o&&(a.isPointerBlocking=o,r.assignPointerEventToLayers()),o&&r.disableBodyPointerEvents(e),m(()=>{r.restoreBodyPointerEvents(e)})},{defer:!0}));const E={registerNestedLayer:D};return T(M.Provider,{value:E,get children(){return T(q,H({as:"div",ref(e){var o=W(a=>n=a,s.ref);typeof o=="function"&&o(e)}},c))}})}export{ue as D,Y as a,ne as c};
