import{i as A,k as _,f as P,l as C,a as W,n as H,m as q,o as $,p as j}from"./index-DeTOQkeb.js";import{b as k,e as E,f as z,m as G,o as Z,a as V,U as J}from"./iframe-BHVPMPJn.js";import{a as l}from"./index-DzweoC3U.js";import{u as Q}from"./LR7LBJN3-Ddt3mnWg.js";import{b as X}from"./FN6EICGO-BXZAkfGN.js";import{c as Y}from"./Utils-CAhjhIiz.js";function R(e){let t=e.startIndex??0;const s=e.startLevel??0,n=[],i=r=>{if(r==null)return"";const f=e.getKey??"key",g=A(f)?r[f]:f(r);return g!=null?String(g):""},d=r=>{if(r==null)return"";const f=e.getTextValue??"textValue",g=A(f)?r[f]:f(r);return g!=null?String(g):""},b=r=>{if(r==null)return!1;const f=e.getDisabled??"disabled";return(A(f)?r[f]:f(r))??!1},S=r=>{if(r!=null)return A(e.getSectionChildren)?r[e.getSectionChildren]:e.getSectionChildren?.(r)};for(const r of e.dataSource){if(A(r)||_(r)){n.push({type:"item",rawValue:r,key:String(r),textValue:String(r),disabled:b(r),level:s,index:t}),t++;continue}if(S(r)!=null){n.push({type:"section",rawValue:r,key:"",textValue:"",disabled:!1,level:s,index:t}),t++;const f=S(r)??[];if(f.length>0){const g=R({dataSource:f,getKey:e.getKey,getTextValue:e.getTextValue,getDisabled:e.getDisabled,getSectionChildren:e.getSectionChildren,startIndex:t,startLevel:s+1});n.push(...g),t+=g.length}}else n.push({type:"item",rawValue:r,key:i(r),textValue:d(r),disabled:b(r),level:s,index:t}),t++}return n}function ee(e,t=[]){return k(()=>{const s=R({dataSource:l(e.dataSource),getKey:l(e.getKey),getTextValue:l(e.getTextValue),getDisabled:l(e.getDisabled),getSectionChildren:l(e.getSectionChildren)});for(let n=0;n<t.length;n++)t[n]();return e.factory(s)})}var F=class U extends Set{anchorKey;currentKey;constructor(t,s,n){super(t),t instanceof U?(this.anchorKey=s||t.anchorKey,this.currentKey=n||t.currentKey):(this.anchorKey=s,this.currentKey=n)}};function te(e){const[t,s]=X(e);return[()=>t()??new F,s]}function N(e){return $()?e.altKey:e.ctrlKey}function T(e){return j()?e.metaKey:e.ctrlKey}function O(e){return new F(e)}function se(e,t){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}function ne(e){const t=q({selectionMode:"none",selectionBehavior:"toggle"},e),[s,n]=V(!1),[i,d]=V(),b=k(()=>{const m=l(t.selectedKeys);return m!=null?O(m):m}),S=k(()=>{const m=l(t.defaultSelectedKeys);return m!=null?O(m):new F}),[r,f]=te({value:b,defaultValue:S,onChange:m=>t.onSelectionChange?.(m)}),[g,w]=V(l(t.selectionBehavior)),D=()=>l(t.selectionMode),I=()=>l(t.disallowEmptySelection)??!1,x=m=>{(l(t.allowDuplicateSelectionEvents)||!se(m,r()))&&f(m)};return E(()=>{const m=r();l(t.selectionBehavior)==="replace"&&g()==="toggle"&&typeof m=="object"&&m.size===0&&w("replace")}),E(()=>{w(l(t.selectionBehavior)??"toggle")}),{selectionMode:D,disallowEmptySelection:I,selectionBehavior:g,setSelectionBehavior:w,isFocused:s,setFocused:n,focusedKey:i,setFocusedKey:d,selectedKeys:r,setSelectedKeys:x}}function le(e){const[t,s]=V(""),[n,i]=V(-1);return{typeSelectHandlers:{onKeyDown:b=>{if(l(e.isDisabled))return;const S=l(e.keyboardDelegate),r=l(e.selectionManager);if(!S.getKeyForSearch)return;const f=ie(b.key);if(!f||b.ctrlKey||b.metaKey)return;f===" "&&t().trim().length>0&&(b.preventDefault(),b.stopPropagation());let g=s(D=>D+f),w=S.getKeyForSearch(g,r.focusedKey())??S.getKeyForSearch(g);w==null&&oe(g)&&(g=g[0],w=S.getKeyForSearch(g,r.focusedKey())??S.getKeyForSearch(g)),w!=null&&(r.setFocusedKey(w),e.onTypeSelect?.(w)),clearTimeout(n()),i(window.setTimeout(()=>s(""),500))}}}}function ie(e){return e.length===1||!/^[A-Z]/i.test(e)?e:""}function oe(e){return e.split("").every(t=>t===e[0])}function ge(e,t,s){const i=G({selectOnFocus:()=>l(e.selectionManager).selectionBehavior()==="replace"},e),d=()=>s?.()??t(),{direction:b}=Q();let S={top:0,left:0};Y(()=>l(i.isVirtualized)?void 0:d(),"scroll",()=>{const o=d();o&&(S={top:o.scrollTop,left:o.scrollLeft})});const{typeSelectHandlers:r}=le({isDisabled:()=>l(i.disallowTypeAhead),keyboardDelegate:()=>l(i.keyboardDelegate),selectionManager:()=>l(i.selectionManager)}),f=()=>l(i.orientation)??"vertical",g=o=>{W(o,r.onKeyDown),o.altKey&&o.key==="Tab"&&o.preventDefault();const y=t();if(!y?.contains(o.target))return;const c=l(i.selectionManager),h=l(i.selectOnFocus),K=u=>{u!=null&&(c.setFocusedKey(u),o.shiftKey&&c.selectionMode()==="multiple"?c.extendSelection(u):h&&!N(o)&&c.replaceSelection(u))},a=l(i.keyboardDelegate),M=l(i.shouldFocusWrap),v=c.focusedKey();switch(o.key){case(f()==="vertical"?"ArrowDown":"ArrowRight"):{if(a.getKeyBelow){o.preventDefault();let u;v!=null?u=a.getKeyBelow(v):u=a.getFirstKey?.(),u==null&&M&&(u=a.getFirstKey?.(v)),K(u)}break}case(f()==="vertical"?"ArrowUp":"ArrowLeft"):{if(a.getKeyAbove){o.preventDefault();let u;v!=null?u=a.getKeyAbove(v):u=a.getLastKey?.(),u==null&&M&&(u=a.getLastKey?.(v)),K(u)}break}case(f()==="vertical"?"ArrowLeft":"ArrowUp"):{if(a.getKeyLeftOf){o.preventDefault();const u=b()==="rtl";let p;v!=null?p=a.getKeyLeftOf(v):p=u?a.getFirstKey?.():a.getLastKey?.(),K(p)}break}case(f()==="vertical"?"ArrowRight":"ArrowDown"):{if(a.getKeyRightOf){o.preventDefault();const u=b()==="rtl";let p;v!=null?p=a.getKeyRightOf(v):p=u?a.getLastKey?.():a.getFirstKey?.(),K(p)}break}case"Home":if(a.getFirstKey){o.preventDefault();const u=a.getFirstKey(v,T(o));u!=null&&(c.setFocusedKey(u),T(o)&&o.shiftKey&&c.selectionMode()==="multiple"?c.extendSelection(u):h&&c.replaceSelection(u))}break;case"End":if(a.getLastKey){o.preventDefault();const u=a.getLastKey(v,T(o));u!=null&&(c.setFocusedKey(u),T(o)&&o.shiftKey&&c.selectionMode()==="multiple"?c.extendSelection(u):h&&c.replaceSelection(u))}break;case"PageDown":if(a.getKeyPageBelow&&v!=null){o.preventDefault();const u=a.getKeyPageBelow(v);K(u)}break;case"PageUp":if(a.getKeyPageAbove&&v!=null){o.preventDefault();const u=a.getKeyPageAbove(v);K(u)}break;case"a":T(o)&&c.selectionMode()==="multiple"&&l(i.disallowSelectAll)!==!0&&(o.preventDefault(),c.selectAll());break;case"Escape":o.defaultPrevented||(o.preventDefault(),l(i.disallowEmptySelection)||c.clearSelection());break;case"Tab":if(!l(i.allowsTabNavigation)){if(o.shiftKey)y.focus();else{const u=H(y,{tabbable:!0});let p,L;do L=u.lastChild(),L&&(p=L);while(L);p&&!p.contains(document.activeElement)&&P(p)}break}}},w=o=>{const y=l(i.selectionManager),c=l(i.keyboardDelegate),h=l(i.selectOnFocus);if(y.isFocused()){o.currentTarget.contains(o.target)||y.setFocused(!1);return}if(o.currentTarget.contains(o.target)){if(y.setFocused(!0),y.focusedKey()==null){const K=M=>{M!=null&&(y.setFocusedKey(M),h&&y.replaceSelection(M))},a=o.relatedTarget;a&&o.currentTarget.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING?K(y.lastSelectedKey()??c.getLastKey?.()):K(y.firstSelectedKey()??c.getFirstKey?.())}else if(!l(i.isVirtualized)){const K=d();if(K){K.scrollTop=S.top,K.scrollLeft=S.left;const a=K.querySelector(`[data-key="${y.focusedKey()}"]`);a&&(P(a),C(K,a))}}}},D=o=>{const y=l(i.selectionManager);o.currentTarget.contains(o.relatedTarget)||y.setFocused(!1)},I=o=>{d()===o.target&&o.preventDefault()},x=()=>{const o=l(i.autoFocus);if(!o)return;const y=l(i.selectionManager),c=l(i.keyboardDelegate);let h;o==="first"&&(h=c.getFirstKey?.()),o==="last"&&(h=c.getLastKey?.());const K=y.selectedKeys();K.size&&(h=K.values().next().value),y.setFocused(!0),y.setFocusedKey(h);const a=t();a&&h==null&&!l(i.shouldUseVirtualFocus)&&P(a)};return Z(()=>{i.deferAutoFocus?setTimeout(x,0):x()}),E(z([d,()=>l(i.isVirtualized),()=>l(i.selectionManager).focusedKey()],o=>{const[y,c,h]=o;if(c)h&&i.scrollToKey?.(h);else if(h&&y){const K=y.querySelector(`[data-key="${h}"]`);K&&C(y,K)}})),{tabIndex:k(()=>{if(!l(i.shouldUseVirtualFocus))return l(i.selectionManager).focusedKey()==null?0:-1}),onKeyDown:g,onMouseDown:I,onFocusIn:w,onFocusOut:D}}function Ke(e,t){const s=()=>l(e.selectionManager),n=()=>l(e.key),i=()=>l(e.shouldUseVirtualFocus),d=c=>{s().selectionMode()!=="none"&&(s().selectionMode()==="single"?s().isSelected(n())&&!s().disallowEmptySelection()?s().toggleSelection(n()):s().replaceSelection(n()):c?.shiftKey?s().extendSelection(n()):s().selectionBehavior()==="toggle"||T(c)||"pointerType"in c&&c.pointerType==="touch"?s().toggleSelection(n()):s().replaceSelection(n()))},b=()=>s().isSelected(n()),S=()=>l(e.disabled)||s().isDisabled(n()),r=()=>!S()&&s().canSelectItem(n());let f=null;const g=c=>{r()&&(f=c.pointerType,c.pointerType==="mouse"&&c.button===0&&!l(e.shouldSelectOnPressUp)&&d(c))},w=c=>{r()&&c.pointerType==="mouse"&&c.button===0&&l(e.shouldSelectOnPressUp)&&l(e.allowsDifferentPressOrigin)&&d(c)},D=c=>{r()&&(l(e.shouldSelectOnPressUp)&&!l(e.allowsDifferentPressOrigin)||f!=="mouse")&&d(c)},I=c=>{!r()||!["Enter"," "].includes(c.key)||(N(c)?s().toggleSelection(n()):d(c))},x=c=>{S()&&c.preventDefault()},m=c=>{const h=t();i()||S()||!h||c.target===h&&s().setFocusedKey(n())},o=k(()=>{if(!(i()||S()))return n()===s().focusedKey()?0:-1}),y=k(()=>l(e.virtualized)?void 0:n());return E(z([t,n,i,()=>s().focusedKey(),()=>s().isFocused()],([c,h,K,a,M])=>{c&&h===a&&M&&!K&&document.activeElement!==c&&(e.focus?e.focus():P(c))})),{isSelected:b,isDisabled:S,allowsSelection:r,tabIndex:o,dataKey:y,onPointerDown:g,onPointerUp:w,onClick:D,onKeyDown:I,onMouseDown:x,onFocus:m}}var ce=class{collection;state;constructor(e,t){this.collection=e,this.state=t}selectionMode(){return this.state.selectionMode()}disallowEmptySelection(){return this.state.disallowEmptySelection()}selectionBehavior(){return this.state.selectionBehavior()}setSelectionBehavior(e){this.state.setSelectionBehavior(e)}isFocused(){return this.state.isFocused()}setFocused(e){this.state.setFocused(e)}focusedKey(){return this.state.focusedKey()}setFocusedKey(e){(e==null||this.collection().getItem(e))&&this.state.setFocusedKey(e)}selectedKeys(){return this.state.selectedKeys()}isSelected(e){if(this.state.selectionMode()==="none")return!1;const t=this.getKey(e);return t==null?!1:this.state.selectedKeys().has(t)}isEmpty(){return this.state.selectedKeys().size===0}isSelectAll(){if(this.isEmpty())return!1;const e=this.state.selectedKeys();return this.getAllSelectableKeys().every(t=>e.has(t))}firstSelectedKey(){let e;for(const t of this.state.selectedKeys()){const s=this.collection().getItem(t),n=s?.index!=null&&e?.index!=null&&s.index<e.index;(!e||n)&&(e=s)}return e?.key}lastSelectedKey(){let e;for(const t of this.state.selectedKeys()){const s=this.collection().getItem(t),n=s?.index!=null&&e?.index!=null&&s.index>e.index;(!e||n)&&(e=s)}return e?.key}extendSelection(e){if(this.selectionMode()==="none")return;if(this.selectionMode()==="single"){this.replaceSelection(e);return}const t=this.getKey(e);if(t==null)return;const s=this.state.selectedKeys(),n=s.anchorKey||t,i=new F(s,n,t);for(const d of this.getKeyRange(n,s.currentKey||t))i.delete(d);for(const d of this.getKeyRange(t,n))this.canSelectItem(d)&&i.add(d);this.state.setSelectedKeys(i)}getKeyRange(e,t){const s=this.collection().getItem(e),n=this.collection().getItem(t);return s&&n?s.index!=null&&n.index!=null&&s.index<=n.index?this.getKeyRangeInternal(e,t):this.getKeyRangeInternal(t,e):[]}getKeyRangeInternal(e,t){const s=[];let n=e;for(;n!=null;){const i=this.collection().getItem(n);if(i&&i.type==="item"&&s.push(n),n===t)return s;n=this.collection().getKeyAfter(n)}return[]}getKey(e){const t=this.collection().getItem(e);return t?!t||t.type!=="item"?null:t.key:e}toggleSelection(e){if(this.selectionMode()==="none")return;if(this.selectionMode()==="single"&&!this.isSelected(e)){this.replaceSelection(e);return}const t=this.getKey(e);if(t==null)return;const s=new F(this.state.selectedKeys());s.has(t)?s.delete(t):this.canSelectItem(t)&&(s.add(t),s.anchorKey=t,s.currentKey=t),!(this.disallowEmptySelection()&&s.size===0)&&this.state.setSelectedKeys(s)}replaceSelection(e){if(this.selectionMode()==="none")return;const t=this.getKey(e);if(t==null)return;const s=this.canSelectItem(t)?new F([t],t,t):new F;this.state.setSelectedKeys(s)}setSelectedKeys(e){if(this.selectionMode()==="none")return;const t=new F;for(const s of e){const n=this.getKey(s);if(n!=null&&(t.add(n),this.selectionMode()==="single"))break}this.state.setSelectedKeys(t)}selectAll(){this.selectionMode()==="multiple"&&this.state.setSelectedKeys(new Set(this.getAllSelectableKeys()))}clearSelection(){const e=this.state.selectedKeys();!this.disallowEmptySelection()&&e.size>0&&this.state.setSelectedKeys(new F)}toggleSelectAll(){this.isSelectAll()?this.clearSelection():this.selectAll()}select(e,t){this.selectionMode()!=="none"&&(this.selectionMode()==="single"?this.isSelected(e)&&!this.disallowEmptySelection()?this.toggleSelection(e):this.replaceSelection(e):this.selectionBehavior()==="toggle"||t&&t.pointerType==="touch"?this.toggleSelection(e):this.replaceSelection(e))}isSelectionEqual(e){if(e===this.state.selectedKeys())return!0;const t=this.selectedKeys();if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;for(const s of t)if(!e.has(s))return!1;return!0}canSelectItem(e){if(this.state.selectionMode()==="none")return!1;const t=this.collection().getItem(e);return t!=null&&!t.disabled}isDisabled(e){const t=this.collection().getItem(e);return!t||t.disabled}getAllSelectableKeys(){const e=[];return(s=>{for(;s!=null;){if(this.canSelectItem(s)){const n=this.collection().getItem(s);if(!n)continue;n.type==="item"&&e.push(s)}s=this.collection().getKeyAfter(s)}})(this.collection().getFirstKey()),e}},B=class{keyMap=new Map;iterable;firstKey;lastKey;constructor(e){this.iterable=e;for(const n of e)this.keyMap.set(n.key,n);if(this.keyMap.size===0)return;let t,s=0;for(const[n,i]of this.keyMap)t?(t.nextKey=n,i.prevKey=t.key):(this.firstKey=n,i.prevKey=void 0),i.type==="item"&&(i.index=s++),t=i,t.nextKey=void 0;this.lastKey=t.key}*[Symbol.iterator](){yield*this.iterable}getSize(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){return this.keyMap.get(e)?.prevKey}getKeyAfter(e){return this.keyMap.get(e)?.nextKey}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){return this.keyMap.get(e)}at(e){const t=[...this.getKeys()];return this.getItem(t[e])}};function he(e){const t=ne(e),n=ee({dataSource:()=>l(e.dataSource),getKey:()=>l(e.getKey),getTextValue:()=>l(e.getTextValue),getDisabled:()=>l(e.getDisabled),getSectionChildren:()=>l(e.getSectionChildren),factory:d=>e.filter?new B(e.filter(d)):new B(d)},[()=>e.filter]),i=new ce(n,t);return J(()=>{const d=t.focusedKey();d!=null&&!n().getItem(d)&&t.setFocusedKey(void 0)}),{collection:n,selectionManager:()=>i}}export{F as S,Ke as a,he as b,ge as c,le as d,se as i};
