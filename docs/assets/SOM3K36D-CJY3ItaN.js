import{c as g}from"./FN6EICGO-DxliCwKo.js";import{m as C,g as D,b as I}from"./index-BtT_u8Hx.js";import{e as l,j as a,c as h,g as p,u as O}from"./iframe-CSkHCzVC.js";import{a as P}from"./index-BqxmMzY1.js";var f=p();function E(){return O(f)}function v(){const e=E();if(e===void 0)throw new Error("[kobalte]: `useDomCollectionContext` must be used within a `DomCollectionProvider` component");return e}function m(e,o){return!!(o.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING)}function b(e,o){const t=o.ref();if(!t)return-1;let n=e.length;if(!n)return-1;for(;n--;){const s=e[n]?.ref();if(s&&m(s,t))return n+1}return 0}function x(e){const o=e.map((n,s)=>[s,n]);let t=!1;return o.sort(([n,s],[r,i])=>{const c=s.ref(),u=i.ref();return c===u||!c||!u?0:m(c,u)?(n>r&&(t=!0),-1):(n<r&&(t=!0),1)}),t?o.map(([n,s])=>s):e}function d(e,o){const t=x(e);e!==t&&o(t)}function w(e){const o=e[0],t=e[e.length-1]?.ref();let n=o?.ref()?.parentElement;for(;n;){if(t&&n.contains(t))return n;n=n.parentElement}return D(n).body}function T(e,o){l(()=>{const t=setTimeout(()=>{d(e(),o)});a(()=>clearTimeout(t))})}function M(e,o){if(typeof IntersectionObserver!="function"){T(e,o);return}let t=[];l(()=>{const n=()=>{const i=!!t.length;t=e(),i&&d(e(),o)},s=w(e()),r=new IntersectionObserver(n,{root:s});for(const i of e()){const c=i.ref();c&&r.observe(c)}a(()=>r.disconnect())})}function S(e={}){const[o,t]=g({value:()=>P(e.items),onChange:r=>e.onItemsChange?.(r)});M(o,t);const n=r=>(t(i=>{const c=b(i,r);return I(i,r,c)}),()=>{t(i=>{const c=i.filter(u=>u.ref()!==r.ref());return i.length===c.length?i:c})});return{DomCollectionProvider:r=>h(f.Provider,{value:{registerItem:n},get children(){return r.children}})}}function _(e){const o=v(),t=C({shouldRegisterItem:!0},e);l(()=>{if(!t.shouldRegisterItem)return;const n=o.registerItem(t.getItem());a(n)})}export{_ as a,S as c,E as u};
