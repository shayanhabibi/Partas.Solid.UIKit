import{g as y,C as K,h,D as N,d as v,E as A}from"./index-BtT_u8Hx.js";import{e as O,j as m,s as S,o as R,f as U,c as T,m as H,g as V,u as $}from"./iframe-CSkHCzVC.js";import{a as x}from"./index-BqxmMzY1.js";import{P as j}from"./FLVHQV4A-Dza2M8WJ.js";import{m as W}from"./index-Bs2ALodi.js";var Y="data-kb-top-layer",C,w=!1,u=[];function f(n){return u.findIndex(t=>t.node===n)}function q(n){return u[f(n)]}function z(n){return u[u.length-1].node===n}function I(){return u.filter(n=>n.isPointerBlocking)}function G(){return[...I()].slice(-1)[0]}function b(){return I().length>0}function F(n){const t=f(G()?.node);return f(n)<t}function J(n){u.push(n)}function Q(n){const t=f(n);t<0||u.splice(t,1)}function X(){for(const{node:n}of u)n.style.pointerEvents=F(n)?"none":"auto"}function Z(n){if(b()&&!w){const t=y(n);C=document.body.style.pointerEvents,t.body.style.pointerEvents="none",w=!0}}function ee(n){if(b())return;const t=y(n);t.body.style.pointerEvents=C,t.body.style.length===0&&t.body.removeAttribute("style"),w=!1}var r={layers:u,isTopMostLayer:z,hasPointerBlockingLayer:b,isBelowPointerBlockingLayer:F,addLayer:J,removeLayer:Q,indexOf:f,find:q,assignPointerEventToLayers:X,disableBodyPointerEvents:Z,restoreBodyPointerEvents:ee},k="interactOutside.pointerDownOutside",B="interactOutside.focusOutside";function te(n,t){let i,s=K;const c=()=>y(t()),d=e=>n.onPointerDownOutside?.(e),D=e=>n.onFocusOutside?.(e),g=e=>n.onInteractOutside?.(e),P=e=>{const o=e.target;return!(o instanceof Element)||o.closest(`[${Y}]`)||!v(c(),o)||v(t(),o)?!1:!n.shouldExcludeElement?.(o)},L=e=>{function o(){const a=t(),l=e.target;if(!a||!l||!P(e))return;const p=h([d,g]);l.addEventListener(k,p,{once:!0});const _=new CustomEvent(k,{bubbles:!1,cancelable:!0,detail:{originalEvent:e,isContextMenu:e.button===2||N(e)&&e.button===0}});l.dispatchEvent(_)}e.pointerType==="touch"?(c().removeEventListener("click",o),s=o,c().addEventListener("click",o,{once:!0})):o()},E=e=>{const o=t(),a=e.target;if(!o||!a||!P(e))return;const l=h([D,g]);a.addEventListener(B,l,{once:!0});const p=new CustomEvent(B,{bubbles:!1,cancelable:!0,detail:{originalEvent:e,isContextMenu:!1}});a.dispatchEvent(p)};O(()=>{x(n.isDisabled)||(i=window.setTimeout(()=>{c().addEventListener("pointerdown",L,!0)},0),c().addEventListener("focusin",E,!0),m(()=>{window.clearTimeout(i),c().removeEventListener("click",s),c().removeEventListener("pointerdown",L,!0),c().removeEventListener("focusin",E,!0)}))})}function ne(n){const t=i=>{i.key===A.Escape&&n.onEscapeKeyDown?.(i)};O(()=>{if(x(n.isDisabled))return;const i=n.ownerDocument?.()??y();i.addEventListener("keydown",t),m(()=>{i.removeEventListener("keydown",t)})})}var M=V();function oe(){return $(M)}function ue(n){let t;const i=oe(),[s,c]=S(n,["ref","disableOutsidePointerEvents","excludedElements","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss","bypassTopMostLayerCheck"]),d=new Set([]),D=e=>{d.add(e);const o=i?.registerNestedLayer(e);return()=>{d.delete(e),o?.()}};te({shouldExcludeElement:e=>t?s.excludedElements?.some(o=>v(o(),e))||[...d].some(o=>v(o,e)):!1,onPointerDownOutside:e=>{!t||r.isBelowPointerBlockingLayer(t)||!s.bypassTopMostLayerCheck&&!r.isTopMostLayer(t)||(s.onPointerDownOutside?.(e),s.onInteractOutside?.(e),e.defaultPrevented||s.onDismiss?.())},onFocusOutside:e=>{s.onFocusOutside?.(e),s.onInteractOutside?.(e),e.defaultPrevented||s.onDismiss?.()}},()=>t),ne({ownerDocument:()=>y(t),onEscapeKeyDown:e=>{!t||!r.isTopMostLayer(t)||(s.onEscapeKeyDown?.(e),!e.defaultPrevented&&s.onDismiss&&(e.preventDefault(),s.onDismiss()))}}),R(()=>{if(!t)return;r.addLayer({node:t,isPointerBlocking:s.disableOutsidePointerEvents,dismiss:s.onDismiss});const e=i?.registerNestedLayer(t);r.assignPointerEventToLayers(),r.disableBodyPointerEvents(t),m(()=>{t&&(r.removeLayer(t),e?.(),r.assignPointerEventToLayers(),r.restoreBodyPointerEvents(t))})}),O(U([()=>t,()=>s.disableOutsidePointerEvents],([e,o])=>{if(!e)return;const a=r.find(e);a&&a.isPointerBlocking!==o&&(a.isPointerBlocking=o,r.assignPointerEventToLayers()),o&&r.disableBodyPointerEvents(e),m(()=>{r.restoreBodyPointerEvents(e)})},{defer:!0}));const E={registerNestedLayer:D};return T(M.Provider,{value:E,get children(){return T(j,H({as:"div",ref(e){var o=W(a=>t=a,s.ref);typeof o=="function"&&o(e)}},c))}})}export{ue as D,Y as a,te as c};
